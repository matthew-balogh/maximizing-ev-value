<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matthew Balogh">

<title>Maximizing Electric Car Value</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#preamble" id="toc-preamble" class="nav-link active" data-scroll-target="#preamble">Preamble</a></li>
  <li><a href="#report-overview" id="toc-report-overview" class="nav-link" data-scroll-target="#report-overview">Report Overview</a></li>
  <li><a href="#sales-trend-in-the-us" id="toc-sales-trend-in-the-us" class="nav-link" data-scroll-target="#sales-trend-in-the-us">Sales Trend in the US</a></li>
  <li><a href="#retail-price-per-mile-trend-in-the-us" id="toc-retail-price-per-mile-trend-in-the-us" class="nav-link" data-scroll-target="#retail-price-per-mile-trend-in-the-us">Retail Price per Mile trend in the US</a></li>
  <li><a href="#exploring-drivers-of-retail-price" id="toc-exploring-drivers-of-retail-price" class="nav-link" data-scroll-target="#exploring-drivers-of-retail-price">Exploring drivers of Retail Price</a></li>
  <li><a href="#looking-for-a-better-driver-for-phevs" id="toc-looking-for-a-better-driver-for-phevs" class="nav-link" data-scroll-target="#looking-for-a-better-driver-for-phevs">Looking for a better driver for PHEVs</a></li>
  <li><a href="#concepts" id="toc-concepts" class="nav-link" data-scroll-target="#concepts">Concepts</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="main.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Maximizing Electric Car Value</h1>
<p class="subtitle lead">A brief case study on exploring trends with applications of Linear Regression</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Matthew Balogh </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div style="page-break-after: always;"></div>
<section id="preamble" class="level1">
<h1>Preamble</h1>
<p>This brief case study aims to provide insights on Electric Vehicles sales and retail price. The study was inspired and guided by a course on <em>Brilliant</em> <span class="citation" data-cites="brllnt-cs-std"><a href="#ref-brllnt-cs-std" role="doc-biblioref">[1]</a></span>. After completing it on the learning platform, I decided to single-handedly recreate the report using <code>R</code> language.</p>
<p>While for the first two insights, I could get direct access to the datasource that was used in the course, for the subsequent insights, the underlying data was an aggregated one from various sources. The first two insights, therefore focus on importing, transforming, and visualizing the available dataset. For the subsequent ones, however, hard copies of plots and graphs had been provided and the focus has been shifted from processing the data to interpreting characteristics and statistics of it in more details.</p>
<div style="page-break-after: always;"></div>
</section>
<section id="report-overview" class="level1">
<h1>Report Overview</h1>
<div id="fig-overview" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-overview-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-overview" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overview-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-overview-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="main_files/figure-html/fig-overview-1.png" class="img-fluid figure-img" data-ref-parent="fig-overview" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-overview-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <strong>How does EV car sales compare to non-EV sales?</strong> EV car sales are on the rise compared to all car sales, especially after 2020 with a steep increase.
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-overview" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overview-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-overview-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="main_files/figure-html/fig-overview-2.png" class="img-fluid figure-img" data-ref-parent="fig-overview" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-overview-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) <strong>How did retail price per mile of range change over this period?</strong> The indicator for gasoline cars remained steady. While there is still a gap in between EVs and non-EVs, it has decreased substantially over the displayed period.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-overview-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption>
</figure>
</div>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/ev-subpopulation.png" class="img-fluid figure-img"></p>
<figcaption>…</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="sales-trend-in-the-us" class="level1">
<h1>Sales Trend in the US</h1>
<p>The data sources from the <a href="https://www.iea.org/data-and-statistics/data-tools/global-ev-data-explorer">Global EV Outlook</a> of <a href="https://www.iea.org">IEA</a>.</p>
<p><strong>Question:</strong> How does EV car sales compare to non-EV sales?</p>
<p>The results are covered by <a href="#fig-overview-1" class="quarto-xref">Figure&nbsp;1 (a)</a>.</p>
<section id="data-import" class="level2">
<h2 class="anchored" data-anchor-id="data-import">Data Import</h2>
<p>The data is imported from a CSV file using the <code>read_csv</code> function from the <code>tidyverse</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>ev_sales <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste</span>(<span class="st">"path"</span>, <span class="st">"to"</span>, <span class="st">"dataset.csv"</span>, <span class="at">sep =</span> <span class="st">"/"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="characteristics-of-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="characteristics-of-the-dataset">Characteristics of the dataset</h2>
<p>It contains aggregated historical values for <em>electrical cars</em> including <strong>sales</strong> and <strong>sales share</strong> information for various aspects combined in individual rows.</p>
<p>The dataset has the following columns:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "region"     "category"   "parameter"  "mode"       "powertrain"
[6] "year"       "unit"       "value"     </code></pre>
</div>
</div>
<p>The columns have <em>syntactic</em> names which suit the following operations on the dataset without the need of correcting them.</p>
</section>
<section id="data-transformation" class="level2">
<h2 class="anchored" data-anchor-id="data-transformation">Data Transformation</h2>
<p>Simply importing this dataset into <code>R</code> would result in <code>character</code> and <code>numerical</code> variables. However, there are categorical variables with a well-defined set of possible values: <em>region, category, parameter, mode, powertrain, unit</em>.</p>
<p>These variables can be converted into a more suitable type called <code>factor</code> with the following mutation operation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ev_sales <span class="ot">&lt;-</span> ev_sales <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">factor</span>(region),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">category =</span> <span class="fu">factor</span>(category),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">parameter =</span> <span class="fu">factor</span>(parameter),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">mode =</span> <span class="fu">factor</span>(mode),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">powertrain =</span> <span class="fu">factor</span>(powertrain),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">unit =</span> <span class="fu">factor</span>(unit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-filtering" class="level2">
<h2 class="anchored" data-anchor-id="data-filtering">Data Filtering</h2>
<p>Since the dataset contains multiple regions around the world and aspects of sales, we need to filter for the data related to the <strong>US</strong> and <strong>sales share</strong> as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>us_sales_share <span class="ot">&lt;-</span> ev_sales <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"USA"</span> <span class="sc">&amp;</span> parameter <span class="sc">==</span> <span class="st">"EV sales share"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-visualization" class="level2">
<h2 class="anchored" data-anchor-id="data-visualization">Data Visualization</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To achieve the above graph, I used <code>ggplot</code> from the <code>ggplot2</code> package with the layers of <code>geom_point</code> and <code>geom_line</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(us_sale_share, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">col =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">"orange"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As the <code>mapping</code> argument of <code>ggplot</code> shows above, the abscissa is set to the scale of <strong>year</strong> and the ordinate is to the <em>value</em> of <strong>sales share</strong> in <em>percent</em>.</p>
<p>Scales of the axes have been set up to show 1-step breaks. To indicate that the y-axis is expressed in percent, I used the <code>label_percent</code> function from the package <code>scales</code> with a scale of 1 as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(...) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    ... <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2010</span>, <span class="dv">2022</span>)) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">8</span>), <span class="at">labels =</span> <span class="fu">label_percent</span>(<span class="at">scale =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, to give a simple appearance to the visual, I enabled a classic theme.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(...) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    ... <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="retail-price-per-mile-trend-in-the-us" class="level1">
<h1>Retail Price per Mile trend in the US</h1>
<p>The data sources from the report of <a href="https://www.dallasfed.org/research/economics/2022/0222">Electric vehicles gain ground but still face price, range, charging constraints</a>.</p>
<p><strong>Question:</strong> How did retail price per mile of range change over the last decade or so?</p>
<p>The results are covered by <a href="#fig-overview-2" class="quarto-xref">Figure&nbsp;1 (b)</a>.</p>
<section id="data-import-1" class="level2">
<h2 class="anchored" data-anchor-id="data-import-1">Data Import</h2>
<p>The data is imported from a CSV file just like before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>dollars_per_mile <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste</span>(<span class="st">"path"</span>, <span class="st">"to"</span>, <span class="st">"dataset.csv"</span>, <span class="at">sep =</span> <span class="st">"/"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="characteristics-of-the-dataset-1" class="level2">
<h2 class="anchored" data-anchor-id="characteristics-of-the-dataset-1">Characteristics of the dataset</h2>
<p>It contains historical median values of <strong>dollars per mile of range</strong> for different types of vehicles. The last column, however, contains the lowest EV price / miles indicator.</p>
<p>The dataset has the following columns:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Year"                                 
[2] "Gasoline vehicles"                    
[3] "Electric vehicles (excluding Tesla)"  
[4] "Tesla"                                
[5] "Electric vehicles (lowest MSRP/range)"</code></pre>
</div>
</div>
<p>Most of the columns contain space character, that is, they have <em>non-syntactic</em> name, however, no column requires to be transformed into a <code>factor</code> variable.</p>
</section>
<section id="data-transformation-1" class="level2">
<h2 class="anchored" data-anchor-id="data-transformation-1">Data Transformation</h2>
<p>To make it convenient to work with the dataset, the column names shall be transformed.</p>
<p>There are multiple ways to transform column names into <em>syntactic</em> ones. One approach uses an automatic transformation with the help of <code>janitor::clean_names()</code>, while the other one is a manual approach with the <code>rename</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>dollars_per_mile <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "year"                                "gasoline_vehicles"                  
[3] "electric_vehicles_excluding_tesla"   "tesla"                              
[5] "electric_vehicles_lowest_msrp_range"</code></pre>
</div>
</div>
<p>Since the above column names seem to be too long, I have decided to go with the manual approach.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dollars_per_mile <span class="ot">&lt;-</span> dollars_per_mile <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">year =</span> <span class="st">"Year"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">gasoline =</span> <span class="st">"Gasoline vehicles"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">ev_no_tesla =</span> <span class="st">"Electric vehicles (excluding Tesla)"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">ev_tesla =</span> <span class="st">"Tesla"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">ev_lowest =</span> <span class="st">"Electric vehicles (lowest MSRP/range)"</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "year"        "gasoline"    "ev_no_tesla" "ev_tesla"    "ev_lowest"  </code></pre>
</div>
</div>
</section>
<section id="data-filtering-1" class="level2">
<h2 class="anchored" data-anchor-id="data-filtering-1">Data Filtering</h2>
<p>Since the data of different vehicle types are separated by columns not rows, there is no need for filtering. When the types are needed to be separated, the geom layer shall use the appropriate variable in its <code>mapping</code>.</p>
</section>
<section id="data-visualization-1" class="level2">
<h2 class="anchored" data-anchor-id="data-visualization-1">Data Visualization</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To achieve the above plot, I used pairs of layers of <code>geom_point</code> and <code>geom_line</code> for all the four indicators as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dollars_per_mile, <span class="fu">aes</span>(<span class="at">x =</span> year)) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Gasoline</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> gasoline, <span class="at">col =</span> <span class="st">"1"</span>)) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> gasoline, <span class="at">col =</span> <span class="st">"1"</span>)) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># EV non-Tesla</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> ev_no_tesla, <span class="at">col =</span> <span class="st">"2"</span>)) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ev_no_tesla, <span class="at">col =</span> <span class="st">"2"</span>)) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># EV Tesla</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> ev_tesla, <span class="at">col =</span> <span class="st">"3"</span>)) <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ev_tesla, <span class="at">col =</span> <span class="st">"3"</span>)) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lowest EV indicator</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> ev_lowest, <span class="at">col =</span> <span class="st">"4"</span>)) <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ev_lowest, <span class="at">col =</span> <span class="st">"4"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The abscissa is set to the scale of <strong>year</strong> and the ordinate is to the <strong>dollars per mile</strong>. Since the variable on the x scale is universal for all the layers, I specified it in the <code>mapping</code> of <code>ggplot</code> itself and extended the mapping with the appropriate y variable specification in case of each different indicator.</p>
<p>Scales of the axes have been set up to show 1 and 50-step breaks for x and y, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(...) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    ... <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2012</span>, <span class="dv">2021</span>)) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">600</span>, <span class="at">by =</span> <span class="dv">50</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">600</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To highlight the layers with different colors, I specified the <code>color</code> <code>mapping</code> attribute of each <code>geom_point</code> and <code>geom_line</code> with an ordered sequence and then based on that I specified the colors manually. Also, a readable label has been added to each of these colored groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(...) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(..., <span class="at">col =</span> <span class="st">"1"</span>)) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(..., <span class="at">col =</span> <span class="st">"1"</span>)) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    ... <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"skyblue2"</span>, <span class="st">"red3"</span>, <span class="st">"seagreen"</span>),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Gasoline"</span>, <span class="st">"Non-Tesla EV"</span>, <span class="st">"Tesla (EV)"</span>, <span class="st">"Lowest EV"</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, to give a simple appearance to the visual, I enabled a classic theme as I did in the case of the previous case.</p>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="exploring-drivers-of-retail-price" class="level1">
<h1>Exploring drivers of Retail Price</h1>
<p>According to the previous insight, the price gap between gasoline and EV cars are closing.</p>
<p><strong>Question:</strong> What characteristics of EVs determine their price?</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following data plots and related statistics in this section are from the datasource of the case-study of Brilliant.</p>
</div>
</div>
<p>One could assume that for an EV, <strong>battery capacity</strong> and <strong>range</strong> characteristics are main drivers of <strong>retail price</strong>. To determine if there is a relationship between these variables, one could take a look at their <em>correlation</em>.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Correlation <strong>only</strong> indicates how strong the <strong>linear relationship</strong> (if there is any) is between the observed variables.</p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>              Retail price correlation
EPA Range                        -0.10
Battery (kWh)                    -0.07</code></pre>
</div>
</div>
<p>Both of the above correlations show weak or no relationship with <em>retail price</em>. Moreover, they are both negative.</p>
<p><em>How could it be that neither battery nor range seems to drive retail price and the little correlation coefficient they have is even negative?</em></p>
<p>To find the answer for the question, it is advisable to take a look at these two variables plotted with <em>retail price</em>.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-expl-drvrs-1-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-expl-drvrs-1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/range-vs-price.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-expl-drvrs-1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Plotted data of <em>range</em> and <em>retail price</em>. <span class="citation" data-cites="brllnt-explrng-crrltns"><a href="#ref-brllnt-explrng-crrltns" role="doc-biblioref">[2]</a></span>
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-expl-drvrs-1-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-expl-drvrs-1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/battery-vs-price.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-expl-drvrs-1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Plotted data of <em>battery</em> and <em>retail price</em>. <span class="citation" data-cites="brllnt-explrng-crrltns"><a href="#ref-brllnt-explrng-crrltns" role="doc-biblioref">[2]</a></span>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>In the plots of <a href="#fig-expl-drvrs-1-1" class="quarto-xref">Figure&nbsp;2</a> and <a href="#fig-expl-drvrs-1-2" class="quarto-xref">Figure&nbsp;3</a>, the data points are scattered around with two characteristics:</p>
<ul>
<li>there are data <strong>clusterings</strong> with gaps between them</li>
<li>most of the data are clustered in a rectangular-ish shape, that is, there is low if any covariance between the plotted variables</li>
<li>there are a few but extreme <strong>outliers</strong></li>
</ul>
<p>These characteristics might indicate the following:</p>
<ul>
<li>intermingled <strong>sub-populations</strong> in the dataset</li>
<li>the absence of covariance resulting in the <strong>absence of correlation</strong> presented above</li>
</ul>
<p>Taking a look at one of these oddly scattered characteristics in more details, the <strong>battery capacity</strong>, its histogram in <a href="#fig-expl-drvrs-2-1" class="quarto-xref">Figure&nbsp;4</a> further cements the idea that grouping takes place in between the data points. It seems that the dataset conveys data points related to <strong>sub-populations</strong> based on battery capacity.</p>
<p>It turns out the dataset can be indeed divided into two distinct parts: <strong>BEVs</strong> (Battery EV) and <strong>PHEVs</strong> (Plug-in Hybrid EV). PHEVs have smaller battery capacity than BEVs. This is depicted in <a href="#fig-expl-drvrs-2-2" class="quarto-xref">Figure&nbsp;5</a>.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-expl-drvrs-2-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-expl-drvrs-2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/battery-histogram.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-expl-drvrs-2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Histogram of <em>battery capacity</em> of EVs. <span class="citation" data-cites="brllnt-explrng-sbppltns"><a href="#ref-brllnt-explrng-sbppltns" role="doc-biblioref">[3]</a></span>
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-expl-drvrs-2-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-expl-drvrs-2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/ev-subpopulation.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-expl-drvrs-2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Boxplots of the two distinct sub-populations. <span class="citation" data-cites="brllnt-explrng-sbppltns"><a href="#ref-brllnt-explrng-sbppltns" role="doc-biblioref">[3]</a></span>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>It is expected that separating the dataset by the above aspect would result in a stronger correlation.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                   Retail price correlation Coefficient of determination
BEV EPA Range                        0.6400                       0.4096
BEV Battery (kWh)                    0.6600                       0.4356
PHEV EPA Range                      -0.4400                       0.1936
PHEV Battery (kWh)                  -0.3300                       0.1089</code></pre>
</div>
</div>
<p>In case of BEVs, the correlation makes much more sense. It appears that battery capacity has a moderate relationship with retail price with a <strong>correlation coefficient</strong> of <strong>0.66</strong> and a <strong>coefficient of determination</strong> of <strong>44%</strong>.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Overview definition of <strong>coefficient of determination</strong>. Refine my thoughts.</p>
</div>
</div>
<p>However, in the case of PHEVs, the correlation values are still negative. Moreover, being closer to -1, they now show stronger yet still weak sign of a linear relationship between the data points. In this case the <strong>correlation coefficient</strong> and the <strong>coefficient of determination</strong> are <strong>-0.33</strong> and <strong>11%</strong>, respectively.</p>
<p>Taking a look at the scatter plot could help once again.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-expl-drvrs-3-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-expl-drvrs-3-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/battery-vs-price-bev.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-expl-drvrs-3-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Plotted data of <em>battery</em> and <em>retail price</em> of BEVs. <span class="citation" data-cites="brllnt-bevs"><a href="#ref-brllnt-bevs" role="doc-biblioref">[4]</a></span>
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-expl-drvrs-3-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-expl-drvrs-3-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/battery-vs-price-phev.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-expl-drvrs-3-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Plotted data of <em>battery</em> and <em>retail price</em> of PHEVs. <span class="citation" data-cites="brllnt-phevs"><a href="#ref-brllnt-phevs" role="doc-biblioref">[5]</a></span>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>The scatter plot shows that there are extreme expensive PHEVs with a relatively low-capacity battery. As the battery capacity increases there is a negative trend in these expensive outliers, however, where the data is clustered within the lower parts of the ordinate we might find the answer we are looking for.</p>
<p>Deleting the outliers with expensive retail price, and looking only at the remaining data points might show some trend.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>The source highlights that deleting outliers is not a common task and could lead to fault in predictions, however, in this case, the outliers are high-end luxury cars that we decided to ignore this time.</p>
</div>
</div>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-expl-drvrs-4-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-expl-drvrs-4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/battery-vs-price-phev-wo-outliers.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-expl-drvrs-4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Plotted data of <em>battery</em> and <em>retail price</em> of PHEVs without outliers. <span class="citation" data-cites="brllnt-phevs"><a href="#ref-brllnt-phevs" role="doc-biblioref">[5]</a></span>
</figcaption>
</figure>
</div>
</div>
<div class="cell quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="cell-output-display">
<div id="fig-expl-drvrs-4-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-expl-drvrs-4-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="main_files/figure-html/fig-expl-drvrs-4-2-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-expl-drvrs-4-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: PHEVs without expensive outliers. As the correlation coefficient has already indicated, the data points weakly ‘hug’ the best-fit line.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>As the left plot above depicts, ignoring outliers and keeping the limits of the scales unchanged, the data points seem to follow a trend. However, once we move the data points into zoom, as in the right plot, our opinion changes instantly. The <em>correlation</em> and <em>coefficient of determination</em> are the following:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                   Retail price correlation Coefficient of determination
PHEV Battery (kWh)                   0.3400                       0.1156</code></pre>
</div>
</div>
<p>It appears, unlike BEVs, the battery capacity - even when outliers are ignored - is still not a strong indicator of PHEVs retail price in terms of a linear relationship.</p>
<div style="page-break-after: always;"></div>
</section>
<section id="looking-for-a-better-driver-for-phevs" class="level1">
<h1>Looking for a better driver for PHEVs</h1>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                Retail price correlation Coefficient of determination
PHEV Battery                        0.34                         0.12
PHEV Horsepower                     0.82                         0.67</code></pre>
</div>
</div>
<p>Looking at the <em>PHEV variables</em> and their correlation with <em>retail price</em>, there is <em>horsepower</em> with a correlation coefficient of <span class="math inline">\(0.82\)</span>. With such a strong correlation and a coefficient of determination of <span class="math inline">\(0.67\)</span>, it appears that there is a decent relationship between <em>retail price</em> and <em>horsepower</em>. As <em>horsepower</em> increases so does <em>retail price</em> tend to increase, the question is <strong>what shape</strong> this relationship can be explained by?</p>
<p>Looking at the scatter plot of these two variables, it appears that the difference between <em>retail prices</em> gets bigger and bigger as <em>horsepower</em> increases, therefore a linear model might not best explain the data as depicted in <a href="#fig-bttr-drvr-1" class="quarto-xref">Figure&nbsp;10</a>. Instead, the plot suggests that the association follows an exponential trend.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Switching to a log scale might help in acquiring the suspected non-linear model.</p>
</div>
</div>
<!-- FIXME -->
<!-- ![...](./images/horsepower-vs-price-phev.png){#fig-bttr-drvr-1} -->
<div id="fig-bttr-drvr-1" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bttr-drvr-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bttr-drvr-1" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-bttr-drvr-1-1" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bttr-drvr-1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="main_files/figure-html/fig-bttr-drvr-1-1.png" id="fig-bttr-drvr-1-1" class="img-fluid figure-img" data-ref-parent="fig-bttr-drvr-1" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bttr-drvr-1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bttr-drvr-1" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-bttr-drvr-1-2" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bttr-drvr-1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="main_files/figure-html/fig-bttr-drvr-1-2.png" id="fig-bttr-drvr-1-2" class="img-fluid figure-img" data-ref-parent="fig-bttr-drvr-1" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bttr-drvr-1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bttr-drvr-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Depicting how a linear regression line fitted on the log scale and then transformed back to the linear scale explains the suspected exponential behaviour of the dataset.
</figcaption>
</figure>
</div>
<p>As expected the exponential curve better fits the dataset than the linear line. The <em>resiudal sum of squares (RSS)</em> additionaly shows the difference as follows:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                     RSS
Linear fit      89904.70
Exponential fit 49802.94</code></pre>
</div>
</div>
<div id="fig-bttr-drvr-2" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bttr-drvr-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bttr-drvr-2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-bttr-drvr-2-1" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bttr-drvr-2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="main_files/figure-html/fig-bttr-drvr-2-1.png" id="fig-bttr-drvr-2-1" class="img-fluid figure-img" data-ref-parent="fig-bttr-drvr-2" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bttr-drvr-2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bttr-drvr-2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-bttr-drvr-2-2" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bttr-drvr-2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="main_files/figure-html/fig-bttr-drvr-2-2.png" id="fig-bttr-drvr-2-2" class="img-fluid figure-img" data-ref-parent="fig-bttr-drvr-2" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bttr-drvr-2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bttr-drvr-2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-bttr-drvr-2-3" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bttr-drvr-2-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="main_files/figure-html/fig-bttr-drvr-2-3.png" id="fig-bttr-drvr-2-3" class="img-fluid figure-img" data-ref-parent="fig-bttr-drvr-2" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bttr-drvr-2-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bttr-drvr-2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-bttr-drvr-2-4" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bttr-drvr-2-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="main_files/figure-html/fig-bttr-drvr-2-4.png" id="fig-bttr-drvr-2-4" class="img-fluid figure-img" data-ref-parent="fig-bttr-drvr-2" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bttr-drvr-2-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bttr-drvr-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Visualization of residuals measured from the two different fitted lines (left) and from zero (right).
</figcaption>
</figure>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="concepts" class="level1">
<h1>Concepts</h1>
<p>While creating this report, numerous topics and concepts arose that I wanted to explicitly summarize here. Some of them had been covered in more details in my writing entitled as <a href="https://matthew-balogh.github.io/snrwa/main.pdf">‘A Personal Paper on Statistics and its Real World Applications’</a>.</p>
<ul>
<li>correlation</li>
<li>coefficient of determination</li>
<li>logarithmic scale</li>
<li>residuals</li>
<li>residual sum of squares (RSS)</li>
</ul>
<div style="page-break-after: always;"></div>
</section>
<section id="references" class="level1">

<!-- 

::: {.cell layout-ncol="2"}
::: {.cell-output-display}
![](main_files/figure-html/fig-2-1.png){#fig-2-1 width=672}
:::

::: {.cell-output-display}
![](main_files/figure-html/fig-2-2.png){#fig-2-2 width=672}
:::
:::

 -->



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-brllnt-cs-std" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline"><span>“Case study: Maximizing electric car value,”</span> <em>Brilliant</em>. Available: <a href="https://brilliant.org/courses/capstone-pricing-electric-vehicles">https://brilliant.org/courses/capstone-pricing-electric-vehicles</a></div>
</div>
<div id="ref-brllnt-explrng-crrltns" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline"><span>“Exploring EV correlations, case study: Maximizing electric car value,”</span> <em>Brilliant</em>. Available: <a href="https://brilliant.org/courses/capstone-pricing-electric-vehicles">https://brilliant.org/courses/capstone-pricing-electric-vehicles</a></div>
</div>
<div id="ref-brllnt-explrng-sbppltns" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline"><span>“Exploring data subpopulations, case study: Maximizing electric car value,”</span> <em>Brilliant</em>. Available: <a href="https://brilliant.org/courses/capstone-pricing-electric-vehicles">https://brilliant.org/courses/capstone-pricing-electric-vehicles</a></div>
</div>
<div id="ref-brllnt-bevs" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline"><span>“Battery electric vehicles, case study: Maximizing electric car value,”</span> <em>Brilliant</em>. Available: <a href="https://brilliant.org/courses/capstone-pricing-electric-vehicles">https://brilliant.org/courses/capstone-pricing-electric-vehicles</a></div>
</div>
<div id="ref-brllnt-phevs" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div><div class="csl-right-inline"><span>“Plug-in hybrid electric vehicles, case study: Maximizing electric car value,”</span> <em>Brilliant</em>. Available: <a href="https://brilliant.org/courses/capstone-pricing-electric-vehicles">https://brilliant.org/courses/capstone-pricing-electric-vehicles</a></div>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>